<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>作业提交系统</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', 'Noto Sans SC', sans-serif;
        }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen">
    <div class="w-full max-w-lg mx-auto bg-white rounded-xl shadow-lg p-8 md:p-10">
        
        <div class="text-center mb-8">
            <h1 class="text-3xl font-bold text-gray-800">圣经领导力作业在线提交</h1>
            <p class="text-gray-500 mt-2">请认真填写信息并上传作业文件</p>
        </div>

        <!-- 提交表单 -->
        <form id="submission-form" class="space-y-6">
            <!-- 学生姓名 -->
            <div>
                <label for="student-name" class="block text-sm font-medium text-gray-700 mb-1">学生姓名</label>
                <input type="text" id="student-name" name="studentName" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 transition" placeholder="请输入您的姓名" required>
            </div>

            <!-- 作业种类 -->
            <div>
                <label for="assignment-type" class="block text-sm font-medium text-gray-700 mb-1">作业种类</label>
                <select id="assignment-type" name="assignmentType" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 transition" required>
                    <option value="" disabled selected>--请选择作业科目--</option>
                    <option value="课前阅读报告">课前阅读报告</option>
                    <option value="课后阅读报告">课后阅读报告</option>
                    <option value="简述自己领导风格">简述自己领导风格</option>
                </select>
            </div>

            <!-- 学位 -->
            <div>
                <label for="student-degree" class="block text-sm font-medium text-gray-700 mb-1">学位</label>
                <select id="student-degree" name="studentDegree" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500 transition" required>
                    <option value="" disabled selected>--请选择您的学位--</option>
                    <option value="学士">学士</option>
                    <option value="证书">证书</option>
                </select>
            </div>

            <!-- 文件上传 -->
            <div>
                <label for="file-upload" class="block text-sm font-medium text-gray-700 mb-1">选择文件</label>
                <input type="file" id="file-upload" name="fileUpload" class="w-full text-sm text-gray-500
                    file:mr-4 file:py-2 file:px-4
                    file:rounded-lg file:border-0
                    file:text-sm file:font-semibold
                    file:bg-blue-50 file:text-blue-700
                    hover:file:bg-blue-100 transition" required>
                <p class="text-xs text-gray-500 mt-1">支持 Word, PDF, PPT。</p>
            </div>

            <!-- 提交按钮 -->
            <button type="submit" id="submit-button" class="w-full bg-blue-600 text-white font-bold py-3 px-4 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition duration-300 ease-in-out">
                <span id="button-text">确认提交</span>
                <span id="button-spinner" class="hidden">
                    <svg class="animate-spin -ml-1 mr-3 h-5 w-5 text-white inline-block" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    正在提交...
                </span>
            </button>
        </form>

        <!-- 消息提示区域 -->
        <div id="message-area" class="mt-6 text-center"></div>

    </div>

    <script>
        // ===============================================================
        // == 配置区域: 请将 Google Apps 脚本部署后的网址粘贴到下方 ==
        // ===============================================================
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzf_Bb5vbPHrKFXQNKPUAAaenAsyWuYb5fKvepQuLpMnkfvBrssvw_lw6Qg1YEIFRm72A/exec";
        // ===============================================================

        const form = document.getElementById('submission-form');
        const submitButton = document.getElementById('submit-button');
        const buttonText = document.getElementById('button-text');
        const buttonSpinner = document.getElementById('button-spinner');
        const messageArea = document.getElementById('message-area');
        const fileInput = document.getElementById('file-upload');

        form.addEventListener('submit', async (e) => {
            e.preventDefault();

            if (!fileInput.files[0]) {
                showMessage('请选择要上传的文件！', 'error');
                return;
            }

            // 禁用按钮并显示加载动画
            setLoading(true);
            showMessage('正在上传文件，请稍候...', 'info');
            
            try {
                const file = fileInput.files[0];
                const reader = new FileReader();

                reader.onload = async (event) => {
                    const fileData = event.target.result;
                    
                    const payload = {
                        studentName: document.getElementById('student-name').value,
                        assignmentType: document.getElementById('assignment-type').value,
                        studentDegree: document.getElementById('student-degree').value,
                        fileName: file.name,
                        mimeType: file.type,
                        fileData: fileData // Base64 编码的文件数据
                    };

                    const response = await fetch(SCRIPT_URL, {
                        method: 'POST',
                        body: JSON.stringify(payload),
                        headers: {
                            'Content-Type': 'text/plain;charset=utf-8', // Apps Script Web App needs text/plain for postData
                        },
                    });

                    const result = await response.json();

                    if (result.status === 'success') {
                        showMessage(`提交成功！文件链接：<a href="${result.fileUrl}" target="_blank" class="underline text-blue-600">点击查看</a>`, 'success');
                        form.reset();
                    } else {
                        throw new Error(result.message || '提交失败，请联系老师。');
                    }
                };
                
                reader.onerror = () => {
                     throw new Error('读取文件失败！');
                };

                reader.readAsDataURL(file);

            } catch (error) {
                console.error('Submission Error:', error);
                showMessage(`提交失败：${error.message}`, 'error');
            } finally {
                setLoading(false);
            }
        });

        function setLoading(isLoading) {
            submitButton.disabled = isLoading;
            if (isLoading) {
                buttonText.classList.add('hidden');
                buttonSpinner.classList.remove('hidden');
            } else {
                buttonText.classList.remove('hidden');
                buttonSpinner.classList.add('hidden');
            }
        }

        function showMessage(message, type) {
            messageArea.innerHTML = '';
            const messageDiv = document.createElement('div');
            let bgColor, textColor;
            switch (type) {
                case 'success':
                    bgColor = 'bg-green-100';
                    textColor = 'text-green-800';
                    break;
                case 'error':
                    bgColor = 'bg-red-100';
                    textColor = 'text-red-800';
                    break;
                default:
                    bgColor = 'bg-blue-100';
                    textColor = 'text-blue-800';
            }
            messageDiv.className = `p-4 rounded-lg ${bgColor} ${textColor}`;
            messageDiv.innerHTML = message;
            messageArea.appendChild(messageDiv);
        }
    </script>
</body>
</html>

